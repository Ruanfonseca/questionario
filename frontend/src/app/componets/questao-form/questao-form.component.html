<div class="col-md-12 d-flex align-items-center justify-content-center p-1">
  <form class="bg-light col-md-6 col-sm-12  p-3" [formGroup]="questionForm" (ngSubmit)="submit()">
    <div formGroupName="questao">
      <div class="form-group">

        <label for="textoEnum">Enunciado:</label>
        <textarea class="form-control mb-3" id="textoEnum" name="textoEnum" rows="3" formControlName="texto"
          required></textarea>

        <div formGroupName="tema">
          <label for="temaid">Tema</label>
          <select id="temaid" name="temaid" class="form-control mb-3" formControlName="id" required>
            <ng-container *ngFor="let tema of temas; let t = index">
              <option *ngIf="t == 0" [attr.selected]="true" value="{{tema.id}}">
                {{tema.nome}}
              </option>
              <option *ngIf="t!= 0" value="{{tema.id}}">
                {{tema.nome}}
              </option>
            </ng-container>
          </select>
        </div>

        <label for="bloom">Categoria Bloom</label>
        <select class="form-control mb-3" id="bloom" name="categoriaBloom" formControlName="categoriaBloom" required>
          <option value="Avaliação" selected>Avaliação</option>
          <option value="Síntese">Síntese</option>
          <option value="Analise">Analise</option>
          <option value="Aplicação">Aplicação</option>
          <option value="Compreensão">Compreensão</option>
          <option value="Conhecimento">Conhecimento</option>
        </select>

      </div>

      <hr>

      <div class="form-inline mb-3 ">
        <button (click)="addFigura()" class="btn-default form-control" type="button">Adicionar Figura</button>
      </div>

      <div formArrayName="figuras">
        <div *ngFor="let figura of figuras.controls; let f = index">
          <div class="form-group mb-3" [formGroupName]="f">
            <div class="input-group mb-3">
              <label class="input-group-text" for="inputDescription{{f}}">Descrição</label>
              <input class="form-control" type="text" id="inputDescription{{f}}" formControlName="descricao" />
              <input class="form-control" type="file" (change)="arquivoSelec($event, f)">
              <button type="button" class="btn-danger btn" (click)="deleteFigura(f)">x</button>
            </div>
          </div>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-auto">
          <button (click)="addArtigo()" class="btn-default form-control" type="button">Adicionar
            Artigo</button>
        </div>
      </div>


      <div formArrayName="artigos">
        <div *ngFor="let artigo of artigos.controls; let i=index">
          <div class="form-group p-3" [formGroupName]="i">
            <hr>
            <div class="form-inline justify-content-between mb-3">
              <h2 class="title">Artigo</h2>
              <button type="button" class="btn-danger btn" (click)="deleteArtigo(i)">x</button>
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text" id="artigo-{{i}}-title">Titulo</span>
              <input type="text" class="form-control" id="artigo-{{i}}-title" name="titulo" formControlName="titulo"
                required>
            </div>
            <div class="input-group mb-3">
              <div class="input-group">
                <input type="text" class="form-control" placeholder="https://example.com" id="artigo-{{i}}-url"
                  name="url" formControlName="url" required>
                <span class="input-group-text" id="artigo-{{i}}-url">URL</span>
              </div>
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text" id="artigo-{{i}}-date">Data Publicação</span>
              <input type="date" class="form-control" id="artigo-{{i}}-date" name="data" placeholder="yyyy-MM-dd"
                formControlName="dataPublicacao" required />
            </div>

            <div class="form-group row">
              <div class="col-auto">
                <button (click)="addAutorControl(i)" class="btn-default form-control" type="button">Adicionar
                  Autor</button>
              </div>
            </div>

            <div formArrayName="autor">
              <div *ngFor="let text of getAutorControls(i).controls; let j=index">
                <div class="d-flex form-group">
                  <span class="input-group-text" id="autor{{j}}">Autor</span>
                  <input type="text" class="form-control" id="autor{{j}}" formControlName="{{j}}" required />
                  <button type="button" class="btn-danger btn" (click)="deleteAutorControl(i,j)">x</button>
                </div>
              </div>
            </div>
            <hr>

          </div>
        </div>
      </div>

      <div class="form-inline mb-3 ">
        <button (click)="addFourOpcao()" class="btn-default form-control" type="button"
          [disabled]="opcoes.length>0">Adicionar
          opção</button>
        <span class="text-center ml-3" *ngIf="opcoes.length>0">Não se esqueça de marcar a opção correta!</span>
      </div>

      <div formArrayName="opcoes">
        <div *ngFor="let opcao of opcoes.controls; let k = index">
          <div class="form-group d-flex align-itens-center" [formGroupName]="k">
            <span class="input-group-text" id="opc{{k}}">{{k+1}}</span>
            <textarea class="form-control mb-1" id="opcao-{{k}}-texto" name="texto" rows="2" formControlName="texto" required></textarea>
          </div>
        </div>
      </div>

    </div>

    <div class="form-group mb-3 " *ngIf="opcoes.length>0">
      <span class="input-group-text">Resposta Correta:</span>
        <select class="form-control form-select form-select-lg mb-3 mw-100" formControlName="opcao_correta" required>
          <option *ngFor="let option of opcoes.controls; let l=index" [value]="option.get('texto')?.value">{{l+1}}</option>
        </select>
    </div>

    <div class="form-group">
      <button class="btn-primary form-control" type="submit">{{ btnText }}</button>
    </div>
  </form>
</div>
<div class="p-4">
  <mat-progress-bar *ngIf="!progress" mode="indeterminate" ></mat-progress-bar>
</div>
